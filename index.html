<!-- 主页也没愣着 -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="https://www.xn--vqq068m4ham0n.space/img/logo.svg">
<title>HYQY Chat</title>
<style>
:root{--primary:#1a1a1a;--secondary:#333;--accent:#666;--light:#f8f8f8;--success:#22c55e;--error:#ef4444;--transition:all 0.3s cubic-bezier(0.4,0,0.2,1)}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}
body{background:var(--light);color:var(--primary);min-height:100vh;line-height:1.6}
.navbar{background:#fff;padding:1.2rem 5%;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(0,0,0,0.08);position:sticky;top:0;z-index:100;box-shadow:0 2px 10px rgba(0,0,0,0.02)}
.logo{font-size:1.5rem;font-weight:700;color:var(--primary);text-decoration:none;letter-spacing:-0.02em}
.publish-btn-nav{background:var(--primary);color:#fff;padding:0.6rem 1.5rem;border-radius:8px;text-decoration:none;font-weight:500;transition:var(--transition)}
.publish-btn-nav:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.1)}
.content-section{padding:5rem 5%}
.section-title{font-size:2rem;font-weight:700;text-align:center;margin-bottom:4rem;position:relative}
.section-title::after{content:'';display:block;width:50px;height:3px;background:var(--primary);margin:1rem auto 0;border-radius:3px}
.content-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:2rem;max-width:1400px;margin:0 auto}
.content-card{background:#fff;border-radius:16px;padding:2rem;border:1px solid rgba(0,0,0,0.08);box-shadow:0 5px 20px rgba(0,0,0,0.03);transition:var(--transition);opacity:0;transform:translateY(20px);animation:fadeUp 0.3s ease forwards}
@keyframes fadeUp{to{opacity:1;transform:translateY(0)}}
.content-card:hover{transform:translateY(-5px);box-shadow:0 15px 30px rgba(0,0,0,0.08)}
.card-author{font-weight:600;margin-bottom:0.8rem;color:var(--primary)}
.card-time{font-size:0.9rem;color:var(--accent);margin-bottom:1.5rem;display:block}
.card-content{color:var(--secondary);line-height:1.7;margin-bottom:1.5rem}
.card-actions{display:flex;justify-content:space-between;align-items:center;padding-top:1rem;border-top:1px solid rgba(0,0,0,0.05)}
.like-btn{display:flex;align-items:center;gap:0.5rem;background:none;border:none;color:var(--accent);cursor:pointer;font-size:0.95rem;transition:var(--transition)}
.like-btn:hover{color:var(--error)}
.like-btn.liked{color:var(--error)}
.comment-btn{display:flex;align-items:center;gap:0.5rem;background:none;border:none;color:var(--accent);cursor:pointer;font-size:0.95rem;transition:var(--transition)}
.comment-btn:hover{color:var(--primary)}
.comments-section{margin-top:1.5rem;max-height:0;overflow:hidden;transition:var(--transition)}
.comments-section.active{max-height:500px}
.comment-input{width:100%;padding:0.8rem 1rem;border:1px solid rgba(0,0,0,0.1);border-radius:8px;margin-bottom:1rem;resize:none;min-height:80px;font-size:0.95rem}
.comment-submit{background:var(--primary);color:#fff;border:none;padding:0.6rem 1.2rem;border-radius:6px;cursor:pointer;font-size:0.9rem;transition:var(--transition)}
.comment-submit:hover{opacity:0.9}
.comments-list{margin-top:1rem}
.comment-item{padding:1rem;background:var(--light);border-radius:8px;margin-bottom:0.8rem}
.comment-author{font-weight:600;font-size:0.9rem;margin-bottom:0.3rem}
.comment-text{font-size:0.95rem;color:var(--secondary)}
.loading{text-align:center;padding:4rem;color:var(--accent);font-size:1.1rem}
.toast{position:fixed;bottom:20px;right:20px;padding:1rem 1.5rem;background:var(--primary);color:#fff;border-radius:8px;box-shadow:0 5px 15px rgba(0,0,0,0.1);z-index:1000;opacity:0;transition:var(--transition)}
.toast.show{opacity:1;transform:translateY(0)}
.empty{grid-column:1/-1;text-align:center;padding:4rem;color:var(--accent)}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<nav class="navbar">
<a href="#" class="logo">HYQY Chat</a>
<a href="./upload/" class="publish-btn-nav">发布内容</a>
</nav>

<section id="content" class="content-section">
<h2 class="section-title">聊天内容</h2>
<div class="content-grid" id="content-grid">
<div class="loading">
<i class="fas fa-spinner fa-spin" style="font-size:2rem;margin-bottom:1rem;display:block"></i>加载中...</div>
</div>
</section>

<div class="toast" id="toast"></div>

<script>
const BASE_URL = "https://www.xn--vqq068m4ham0n.space/articles";
const START = 1;
const END = 9999;
let items = [];

document.addEventListener("DOMContentLoaded", async () => {
  await loadAll();
});

async function loadAll() {
  const grid = document.getElementById("content-grid");
  grid.innerHTML = "";
  let found = 0;

  for (let i = START; i <= END; i++) {
    const s = i.toString().padStart(4, "0");
    const url = `${BASE_URL}/data_${s}.json`;
    try {
      const ctrl = new AbortController();
      const to = setTimeout(() => ctrl.abort(), 2500);
      const res = await fetch(url, { signal: ctrl.signal });
      clearTimeout(to);
      if (!res.ok) continue;
      const d = await res.json();
      items.push({ id: s, data: d });
      renderCard(s, d);
      found++;
    } catch (e) {}
  }

  if (found === 0) {
    grid.innerHTML = `<div class="empty"><i class="fas fa-file-code" style="font-size:3rem;margin-bottom:1rem"></i><h3>暂无内容</h3></div>`;
  }
}

function renderCard(id, d) {
  const grid = document.getElementById("content-grid");
  const el = document.createElement("div");
  el.className = "content-card";
  el.setAttribute("data-id", id);

  const likes = d.likes || 0;
  const comments = d.comments || [];

  function fmt(t) {
    try {
      return new Intl.DateTimeFormat("zh-CN", {
        year: "numeric", month: "2-digit", day: "2-digit",
        hour: "2-digit", minute: "2-digit"
      }).format(new Date(t));
    } catch (e) {
      return "未知时间";
    }
  }

  el.innerHTML = `
    <span class="card-author">${d.user || "匿名"}</span>
    <span class="card-time">${fmt(d.publishTime)}</span>
    <div class="card-content">${(d.content || "").replace(/\n/g, "<br>")}</div>
    <div class="card-actions">
      <button class="like-btn"><i class="fas fa-heart"></i><span>${likes}</span></button>
      <button class="comment-btn"><i class="fas fa-comment"></i><span>${comments.length}</span></button>
    </div>
    <div class="comments-section">
      <textarea class="comment-input" placeholder="写下评论..."></textarea>
      <button class="comment-submit">发布评论</button>
      <div class="comments-list">
        ${comments.map(c => `
        <div class="comment-item">
          <div class="comment-author">${c.author || "访客"}</div>
          <div class="comment-text">${c.text}</div>
        </div>`).join("")}
      </div>
    </div>
  `;
  grid.appendChild(el);
}

document.addEventListener("click", e => {
  const card = e.target.closest(".content-card");
  if (!card) return;
  const id = card.getAttribute("data-id");

  if (e.target.closest(".like-btn")) {
    const btn = e.target.closest(".like-btn");
    const num = btn.querySelector("span");
    const cur = parseInt(num.textContent);
    btn.classList.toggle("liked");
    num.textContent = btn.classList.contains("liked") ? cur + 1 : cur - 1;
    showToast("操作成功");
  }

  if (e.target.closest(".comment-btn")) {
    const sec = card.querySelector(".comments-section");
    sec.classList.toggle("active");
  }

  if (e.target.closest(".comment-submit")) {
    const ta = card.querySelector(".comment-input");
    const txt = ta.value.trim();
    if (!txt) return;
    const list = card.querySelector(".comments-list");
    const cnt = card.querySelector(".comment-btn span");
    const div = document.createElement("div");
    div.className = "comment-item";
    div.innerHTML = `<div class="comment-author">我</div><div class="comment-text">${txt}</div>`;
    list.appendChild(div);
    cnt.textContent = parseInt(cnt.textContent) + 1;
    ta.value = "";
    showToast("评论发布成功");
  }
});

function showToast(msg) {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.className = "toast show";
  setTimeout(() => t.classList.remove("show"), 2000);
}
</script>
</body>
</html>
